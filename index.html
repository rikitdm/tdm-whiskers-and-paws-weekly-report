<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Performance Report - HKTV Mall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Weekly Performance Report</h1>
            <p class="text-md text-gray-500">HKTV Mall Demand & Inventory | As of 4 September 2025</p>
        </header>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

            <!-- KPI Cards -->
            <div class="bg-white p-6 rounded-xl shadow-md flex flex-col justify-between">
                <div>
                    <h2 class="text-sm font-medium text-gray-500">SKUs to Order</h2>
                    <p class="text-3xl font-bold text-gray-800">47</p>
                </div>
                <p class="text-sm text-gray-400 mt-2">out of 591 total SKUs</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-md flex flex-col justify-between">
                <div>
                    <h2 class="text-sm font-medium text-gray-500">Inventory Categories</h2>
                    <p class="text-3xl font-bold text-gray-800">2</p>
                </div>
                <p class="text-sm text-gray-400 mt-2">Category A (High-Value) & C (Low-Value)</p>
            </div>
             <div class="bg-white p-6 rounded-xl shadow-md flex flex-col justify-between">
                <div>
                    <h2 class="text-sm font-medium text-gray-500">Pet Fair Sales Lift</h2>
                    <p class="text-3xl font-bold text-green-600">Sharp Increase</p>
                </div>
                <p class="text-sm text-gray-400 mt-2">Observed on VIP days (20th & 22nd)</p>
            </div>
             <div class="bg-white p-6 rounded-xl shadow-md flex flex-col justify-between">
                <div>
                    <h2 class="text-sm font-medium text-gray-500">Price Drop Campaign</h2>
                    <p class="text-3xl font-bold text-gray-800">Concluded</p>
                </div>
                <p class="text-sm text-gray-400 mt-2">For 4 brands in HKTVMall</p>
            </div>


            <!-- Inventory Status Chart -->
            <div class="md:col-span-1 lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Overall Inventory Status</h3>
                <div class="chart-container">
                    <canvas id="inventoryStatusChart"></canvas>
                </div>
            </div>

            <!-- Sales Performance Chart -->
            <div class="md:col-span-1 lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Sales Performance by Category</h3>
                <div class="chart-container">
                    <canvas id="salesPerformanceChart"></canvas>
                </div>
            </div>
            
            <!-- Priorities Table -->
            <div class="md:col-span-2 lg:col-span-4 bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">SKUs Requiring Action (Priority Order)</h3>
                <div class="flex mb-4">
                     <input type="text" id="searchInput" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Search by SKU, brand, or name...">
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SKU ID</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Brand</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product Name</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reorder Point</th>
                            </tr>
                        </thead>
                        <tbody id="actionableSkus" class="bg-white divide-y divide-gray-200">
                            <!-- JS will populate this -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Summary Sections -->
            <div class="md:col-span-1 lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-lg font-semibold text-gray-700 mb-4 text-green-700">What Went Well</h3>
                <ul class="space-y-3 text-gray-600">
                    <li><span class="font-semibold">Platform:</span> Data Transfer Query for HKTV Mall was successful, providing new insights.</li>
                    <li><span class="font-semibold">Product:</span> Successfully updated visuals and BBD for Hills, Dear Deer, Dermcare, and Maxiguard in both stores.</li>
                    <li><span class="font-semibold">Promotion:</span> Traffic and sales rose sharply during the Pet Fair, especially on VIP days for both stores.</li>
                </ul>
            </div>

            <div class="md:col-span-1 lg:col-span-2 bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-lg font-semibold text-gray-700 mb-4 text-red-700">Priorities & Focus Areas</h3>
                <ul class="space-y-3 text-gray-600">
                    <li><span class="font-semibold">Platform:</span> Resolve product image discrepancies in Store 1 & Store 2.</li>
                    <li><span class="font-semibold">Product:</span> Re-label and add authorized stickers for specific brands (Dear Deer, Dermcare, MAXI GUARD).</li>
                    <li><span class="font-semibold">Promotion:</span> Continue to build on the success of recent promotional events and ad campaigns.</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const csvData = `sku_id,brand,name,abc_category,stockout_days,days_observed_90d,avg_daily_sales_90d,sd_daily_sales_90d,total_units_90d,lead_time_days,lead_time_demand,safety_stock,reorder_point,last_snapshot_date,last_day_on_hand,action_plan,order_priority
WP0176,FRONTLINE,Frontline Plus for Dogs-Small DOG-3PACKS,C,3,3,0,0,0,14,0,0,0,04/09/2025,0,No Need To Order,N/A
HK93778,ROYAL CANIN,VHN Anallergenic Cat 2 kg [parallel import] BBD: 23-May-2026,C,2,2,0,0,0,14,0,0,0,04/09/2025,0,No Need To Order,N/A
WP0160,Virbac,"Virbac Enzymatic Toothpaste for Dogs and Cats, Poultry Flavor, 2.5oz (Used By: 1 May 2027)",A,0,3,1,2,4,14,19,14,33,04/09/2025,94,No Need To Order,N/A
HK102883,Catto,Catto - Plus Jelly Immune Booster+ Cat Pouch-70G-20PCS(Random packaging delivery)(BBD:03 Sep 2026),C,0,3,0,0,0,14,0,0,0,04/09/2025,23,No Need To Order,N/A
HK93755,ROYAL CANIN,VHN G-I Gastro intestinal Puppy Dog 1 kg [parallel import] BBD: 2026-MAY-04 (Random packaging),A,0,2,2,2,3,14,21,13,34,04/09/2025,23,Order,P2
HK19480,FROMM,FROMM - Hasen Duckenpfeffer Grain Free Cat Dry Food 10lbs BBD: 7-Jun-2026,C,0,3,0,0,0,14,0,0,0,04/09/2025,27,No Need To Order,N/A
HK21564,Instinct,Instinct - Ultimate Protein Adult Grain Free Duck Cat Dry Food-4LB,C,0,1,0,0,0,14,0,0,0,04/09/2025,10,No Need To Order,N/A`;

        document.addEventListener('DOMContentLoaded', () => {
            // --- Chart 1: Inventory Status ---
            const inventoryStatusCtx = document.getElementById('inventoryStatusChart').getContext('2d');
            new Chart(inventoryStatusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['No Action Needed', 'Requires Ordering'],
                    datasets: [{
                        label: 'SKU Status',
                        data: [544, 47],
                        backgroundColor: [
                            '#4f46e5',
                            '#f59e0b'
                        ],
                        borderColor: '#ffffff',
                        borderWidth: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 14 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        const total = context.dataset.data.reduce((acc, data) => acc + data, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        label += `${context.raw} SKUs (${percentage}%)`;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // --- Chart 2: Sales Performance ---
            const salesPerformanceCtx = document.getElementById('salesPerformanceChart').getContext('2d');
            new Chart(salesPerformanceCtx, {
                type: 'bar',
                data: {
                    labels: ['Category A (High-Value)', 'Category C (Low-Value)'],
                    datasets: [{
                        label: 'Total Implied Sales Quantity',
                        data: [153.0, 46.0],
                        backgroundColor: [
                            '#10b981',
                            '#3b82f6'
                        ],
                        borderRadius: 8,
                        barPercentage: 0.5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                             grid: {
                                display: false
                            }
                        },
                         x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                           display: false
                        },
                    }
                }
            });

            // --- Actionable SKUs Table ---
            const lines = csvData.trim().split('\n').slice(1);
            const headers = ['sku_id', 'brand', 'name', 'abc_category', 'stockout_days', 'days_observed_90d', 'avg_daily_sales_90d', 'sd_daily_sales_90d', 'total_units_90d', 'lead_time_days', 'lead_time_demand', 'safety_stock', 'reorder_point', 'last_snapshot_date', 'last_day_on_hand', 'action_plan', 'order_priority'];
            
            const data = lines.map(line => {
                // Basic CSV parsing - won't handle commas inside quotes perfectly but works for this data.
                const values = line.split(',');
                let obj = {};
                headers.forEach((header, i) => {
                    obj[header] = values[i];
                });
                return obj;
            });

            const skusToOrder = data.filter(item => item.action_plan === 'Order');
            
            // Sort by priority (P1, P2, etc.)
            skusToOrder.sort((a, b) => {
                const priorityA = a.order_priority;
                const priorityB = b.order_priority;
                if(priorityA === 'N/A') return 1;
                if(priorityB === 'N/A') return -1;
                return priorityA.localeCompare(priorityB);
            });

            const tableBody = document.getElementById('actionableSkus');
            const searchInput = document.getElementById('searchInput');

            function renderTable(items) {
                tableBody.innerHTML = '';
                 if (items.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4">No matching SKUs found.</td></tr>';
                    return;
                }
                items.forEach(item => {
                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap"><span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">${item.order_priority}</span></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.sku_id}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.brand}</td>
                            <td class="px-6 py-4 whitespace-normal text-sm text-gray-600 max-w-xs">${item.name.replace(/"/g, '')}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.abc_category}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-red-600">${item.reorder_point}</td>
                        </tr>
                    `;
                    tableBody.innerHTML += row;
                });
            }
            
            searchInput.addEventListener('keyup', () => {
                const searchTerm = searchInput.value.toLowerCase();
                const filteredData = skusToOrder.filter(item => 
                    item.sku_id.toLowerCase().includes(searchTerm) ||
                    item.brand.toLowerCase().includes(searchTerm) ||
                    item.name.toLowerCase().includes(searchTerm)
                );
                renderTable(filteredData);
            });

            // Initial render
            renderTable(skusToOrder);
        });

    </script>
</body>
</html>
